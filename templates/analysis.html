{% extends "layout.html" %}

{% block title %}Match Analysis - Tennis Match Analytics{% endblock %}

{% block head %}
<!-- Additional head content for analysis page -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
{% endblock %}

{% block content %}
<div id="match-data" data-match-id="{{ match.id }}">
    <!-- Analysis Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-1">{{ match.title }}</h1>
            <p class="text-muted">
                <i class="fas fa-calendar-alt me-1"></i> {{ match.date.strftime('%B %d, %Y') }}
                {% if match.opponent %}
                <span class="mx-2">|</span>
                <i class="fas fa-user me-1"></i> vs {{ match.opponent }}
                {% endif %}
                {% if match.location %}
                <span class="mx-2">|</span>
                <i class="fas fa-map-marker-alt me-1"></i> {{ match.location }}
                {% endif %}
            </p>
        </div>
        <div>
            <a href="{{ url_for('match.download_report', match_id=match.id) }}" class="btn btn-success me-2" target="_blank">
                <i class="fas fa-file-download me-1"></i>Download Full Report
            </a>
            <button class="btn btn-outline-primary share-match-btn me-2" data-match-id="{{ match.id }}">
                <i class="fas fa-share-alt me-1"></i>Share Analysis
            </button>
            <a href="{{ url_for('match.match_details', match_id=match.id) }}" class="btn btn-secondary">
                <i class="fas fa-info-circle me-1"></i>Match Details
            </a>
        </div>
    </div>
    
    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="analysisTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                <i class="fas fa-chart-pie me-1"></i>Overview
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="shots-tab" data-bs-toggle="tab" data-bs-target="#shots" type="button" role="tab" aria-controls="shots" aria-selected="false">
                <i class="fas fa-bullseye me-1"></i>Shot Analysis
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="technique-tab" data-bs-toggle="tab" data-bs-target="#technique" type="button" role="tab" aria-controls="technique" aria-selected="false">
                <i class="fas fa-running me-1"></i>Technique
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="false">
                <i class="fas fa-clipboard-list me-1"></i>Detailed Stats
            </button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content" id="analysisTabContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <div class="row">
                <!-- Basic Stats Card -->
                <div class="col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Basic Statistics</h5>
                        </div>
                        <div class="card-body">
                            <div class="stat-item">
                                <div class="stat-label">Aces</div>
                                <div class="stat-value">{{ statistics.basic_stats.aces }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Double Faults</div>
                                <div class="stat-value">{{ statistics.basic_stats.double_faults }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">First Serve %</div>
                                <div class="stat-value">{{ statistics.basic_stats.first_serve_percentage }}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">First Serve Points Won</div>
                                <div class="stat-value">{{ statistics.basic_stats.first_serve_points_won }}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Second Serve Points Won</div>
                                <div class="stat-value">{{ statistics.basic_stats.second_serve_points_won }}%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Break Points Saved</div>
                                <div class="stat-value">{{ statistics.basic_stats.break_points_saved }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Break Points Converted</div>
                                <div class="stat-value">{{ statistics.basic_stats.break_points_converted }}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Total Points Won</div>
                                <div class="stat-value">{{ statistics.basic_stats.total_points_won }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Radar Chart -->
                <div class="col-lg-8 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Performance Overview</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="statsComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Shot Distribution -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Shot Distribution</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="shotDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Game Phases Analysis -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Stroke Phase Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="gamePhaseScoresChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Shot Analysis Tab -->
        <div class="tab-pane fade" id="shots" role="tabpanel" aria-labelledby="shots-tab">
            <div class="row">
                <!-- Shot Placement Chart -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Shot Placement</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="shotPlacementChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Serve Analysis -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Serve Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="serveAnalysisChart"></canvas>
                            </div>
                            <div class="mt-3">
                                <div class="stat-item">
                                    <div class="stat-label">Average Serve Speed</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.serve.speed.avg }} mph</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Max Serve Speed</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.serve.speed.max }} mph</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Forehand Analysis -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Forehand Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h2 class="mb-0 text-success">{{ statistics.shot_analysis.forehand.winners }}</h2>
                                            <p class="mb-0">Winners</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h2 class="mb-0 text-danger">{{ statistics.shot_analysis.forehand.errors }}</h2>
                                            <p class="mb-0">Errors</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h6>Placement Distribution</h6>
                                <div class="stat-item">
                                    <div class="stat-label">Cross Court</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.forehand.placement.cross_court }}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Down The Line</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.forehand.placement.down_the_line }}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Inside Out</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.forehand.placement.inside_out }}</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h6>Speed</h6>
                                <div class="stat-item">
                                    <div class="stat-label">Average</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.forehand.speed.avg }} mph</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Maximum</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.forehand.speed.max }} mph</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Backhand Analysis -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Backhand Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h2 class="mb-0 text-success">{{ statistics.shot_analysis.backhand.winners }}</h2>
                                            <p class="mb-0">Winners</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h2 class="mb-0 text-danger">{{ statistics.shot_analysis.backhand.errors }}</h2>
                                            <p class="mb-0">Errors</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h6>Placement Distribution</h6>
                                <div class="stat-item">
                                    <div class="stat-label">Cross Court</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.backhand.placement.cross_court }}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Down The Line</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.backhand.placement.down_the_line }}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Inside Out</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.backhand.placement.inside_out }}</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h6>Speed</h6>
                                <div class="stat-item">
                                    <div class="stat-label">Average</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.backhand.speed.avg }} mph</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Maximum</div>
                                    <div class="stat-value">{{ statistics.shot_analysis.backhand.speed.max }} mph</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Technique Tab -->
        <div class="tab-pane fade" id="technique" role="tabpanel" aria-labelledby="technique-tab">
            <div class="row">
                <!-- Player Movement Chart -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Player Movement</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="playerMovementChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Preparation Phase -->
                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Preparation Phase</h5>
                            <span class="badge rounded-pill {% if statistics.game_phases.preparation.score >= 80 %}bg-success{% elif statistics.game_phases.preparation.score >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ statistics.game_phases.preparation.score }}/100
                            </span>
                        </div>
                        <div class="card-body">
                            <div class="stage-rating mb-3">
                                <div class="rating-label">Grip Position</div>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar {% if statistics.game_phases.preparation.grip_rating == 'Excellent' %}bg-success{% elif statistics.game_phases.preparation.grip_rating == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                        role="progressbar" 
                                        style="width: {% if statistics.game_phases.preparation.grip_rating == 'Excellent' %}100%{% elif statistics.game_phases.preparation.grip_rating == 'Good' %}70%{% else %}40%{% endif %}" 
                                        aria-valuenow="{% if statistics.game_phases.preparation.grip_rating == 'Excellent' %}100{% elif statistics.game_phases.preparation.grip_rating == 'Good' %}70{% else %}40{% endif %}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="rating-score {% if statistics.game_phases.preparation.grip_rating == 'Excellent' %}rating-excellent{% elif statistics.game_phases.preparation.grip_rating == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                    {{ statistics.game_phases.preparation.grip_rating }}
                                </div>
                            </div>
                            <div class="stage-rating mb-3">
                                <div class="rating-label">Stance</div>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar {% if statistics.game_phases.preparation.stance_rating == 'Excellent' %}bg-success{% elif statistics.game_phases.preparation.stance_rating == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                        role="progressbar" 
                                        style="width: {% if statistics.game_phases.preparation.stance_rating == 'Excellent' %}100%{% elif statistics.game_phases.preparation.stance_rating == 'Good' %}70%{% else %}40%{% endif %}" 
                                        aria-valuenow="{% if statistics.game_phases.preparation.stance_rating == 'Excellent' %}100{% elif statistics.game_phases.preparation.stance_rating == 'Good' %}70{% else %}40{% endif %}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="rating-score {% if statistics.game_phases.preparation.stance_rating == 'Excellent' %}rating-excellent{% elif statistics.game_phases.preparation.stance_rating == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                    {{ statistics.game_phases.preparation.stance_rating }}
                                </div>
                            </div>
                            <div class="stage-rating mb-3">
                                <div class="rating-label">Shoulder Rotation</div>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar {% if statistics.game_phases.preparation.shoulder_rotation == 'Excellent' %}bg-success{% elif statistics.game_phases.preparation.shoulder_rotation == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                        role="progressbar" 
                                        style="width: {% if statistics.game_phases.preparation.shoulder_rotation == 'Excellent' %}100%{% elif statistics.game_phases.preparation.shoulder_rotation == 'Good' %}70%{% else %}40%{% endif %}" 
                                        aria-valuenow="{% if statistics.game_phases.preparation.shoulder_rotation == 'Excellent' %}100{% elif statistics.game_phases.preparation.shoulder_rotation == 'Good' %}70{% else %}40{% endif %}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="rating-score {% if statistics.game_phases.preparation.shoulder_rotation == 'Excellent' %}rating-excellent{% elif statistics.game_phases.preparation.shoulder_rotation == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                    {{ statistics.game_phases.preparation.shoulder_rotation }}
                                </div>
                            </div>
                            <div class="alert alert-primary mt-4">
                                <i class="fas fa-lightbulb me-2"></i>
                                <strong>Improvement tip:</strong> 
                                {% if statistics.game_phases.preparation.shoulder_rotation == 'Needs Improvement' %}
                                Work on your shoulder rotation during preparation. Try the shoulder turn drill: stand sideways to a wall, hold your racket, and practice rotating your shoulders while keeping your grip steady.
                                {% elif statistics.game_phases.preparation.stance_rating == 'Needs Improvement' %}
                                Focus on your stance width and balance. Practice the split-step to improve your ready position and balance.
                                {% elif statistics.game_phases.preparation.grip_rating == 'Needs Improvement' %}
                                Review your grip positioning. Work with continental grip for serves and volleys, and eastern or semi-western for ground strokes.
                                {% else %}
                                Your preparation phase looks solid! Continue to focus on consistency in your pre-shot routine.
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contact & Follow Through -->
                <div class="col-12 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Stroke Execution Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="border-bottom pb-2 mb-3">Backswing Phase</h6>
                                    <div class="stage-rating mb-3">
                                        <div class="rating-label">Body Position</div>
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar {% if statistics.game_phases.backswing.body_position == 'Excellent' %}bg-success{% elif statistics.game_phases.backswing.body_position == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                role="progressbar" 
                                                style="width: {% if statistics.game_phases.backswing.body_position == 'Excellent' %}100%{% elif statistics.game_phases.backswing.body_position == 'Good' %}70%{% else %}40%{% endif %}" 
                                                aria-valuenow="{% if statistics.game_phases.backswing.body_position == 'Excellent' %}100{% elif statistics.game_phases.backswing.body_position == 'Good' %}70{% else %}40{% endif %}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="rating-score {% if statistics.game_phases.backswing.body_position == 'Excellent' %}rating-excellent{% elif statistics.game_phases.backswing.body_position == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                            {{ statistics.game_phases.backswing.body_position }}
                                        </div>
                                    </div>
                                    <div class="stage-rating mb-3">
                                        <div class="rating-label">Racket Path</div>
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar {% if statistics.game_phases.backswing.racket_path == 'Excellent' %}bg-success{% elif statistics.game_phases.backswing.racket_path == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                role="progressbar" 
                                                style="width: {% if statistics.game_phases.backswing.racket_path == 'Excellent' %}100%{% elif statistics.game_phases.backswing.racket_path == 'Good' %}70%{% else %}40%{% endif %}" 
                                                aria-valuenow="{% if statistics.game_phases.backswing.racket_path == 'Excellent' %}100{% elif statistics.game_phases.backswing.racket_path == 'Good' %}70{% else %}40{% endif %}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="rating-score {% if statistics.game_phases.backswing.racket_path == 'Excellent' %}rating-excellent{% elif statistics.game_phases.backswing.racket_path == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                            {{ statistics.game_phases.backswing.racket_path }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="border-bottom pb-2 mb-3">Contact Phase</h6>
                                    <div class="stage-rating mb-3">
                                        <div class="rating-label">Timing</div>
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar {% if statistics.game_phases.contact.timing == 'Excellent' %}bg-success{% elif statistics.game_phases.contact.timing == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                role="progressbar" 
                                                style="width: {% if statistics.game_phases.contact.timing == 'Excellent' %}100%{% elif statistics.game_phases.contact.timing == 'Good' %}70%{% else %}40%{% endif %}" 
                                                aria-valuenow="{% if statistics.game_phases.contact.timing == 'Excellent' %}100{% elif statistics.game_phases.contact.timing == 'Good' %}70{% else %}40{% endif %}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="rating-score {% if statistics.game_phases.contact.timing == 'Excellent' %}rating-excellent{% elif statistics.game_phases.contact.timing == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                            {{ statistics.game_phases.contact.timing }}
                                        </div>
                                    </div>
                                    <div class="stage-rating mb-3">
                                        <div class="rating-label">Accuracy</div>
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar {% if statistics.game_phases.contact.accuracy == 'Excellent' %}bg-success{% elif statistics.game_phases.contact.accuracy == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                role="progressbar" 
                                                style="width: {% if statistics.game_phases.contact.accuracy == 'Excellent' %}100%{% elif statistics.game_phases.contact.accuracy == 'Good' %}70%{% else %}40%{% endif %}" 
                                                aria-valuenow="{% if statistics.game_phases.contact.accuracy == 'Excellent' %}100{% elif statistics.game_phases.contact.accuracy == 'Good' %}70{% else %}40{% endif %}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="rating-score {% if statistics.game_phases.contact.accuracy == 'Excellent' %}rating-excellent{% elif statistics.game_phases.contact.accuracy == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                            {{ statistics.game_phases.contact.accuracy }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 mt-3">
                                    <h6 class="border-bottom pb-2 mb-3">Follow Through Phase</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="stage-rating mb-3">
                                                <div class="rating-label">Completion</div>
                                                <div class="progress flex-grow-1">
                                                    <div class="progress-bar {% if statistics.game_phases.follow_through.completion == 'Excellent' %}bg-success{% elif statistics.game_phases.follow_through.completion == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                        role="progressbar" 
                                                        style="width: {% if statistics.game_phases.follow_through.completion == 'Excellent' %}100%{% elif statistics.game_phases.follow_through.completion == 'Good' %}70%{% else %}40%{% endif %}" 
                                                        aria-valuenow="{% if statistics.game_phases.follow_through.completion == 'Excellent' %}100{% elif statistics.game_phases.follow_through.completion == 'Good' %}70{% else %}40{% endif %}" 
                                                        aria-valuemin="0" 
                                                        aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <div class="rating-score {% if statistics.game_phases.follow_through.completion == 'Excellent' %}rating-excellent{% elif statistics.game_phases.follow_through.completion == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                                    {{ statistics.game_phases.follow_through.completion }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="stage-rating mb-3">
                                                <div class="rating-label">Balance</div>
                                                <div class="progress flex-grow-1">
                                                    <div class="progress-bar {% if statistics.game_phases.follow_through.balance == 'Excellent' %}bg-success{% elif statistics.game_phases.follow_through.balance == 'Good' %}bg-warning{% else %}bg-danger{% endif %}" 
                                                        role="progressbar" 
                                                        style="width: {% if statistics.game_phases.follow_through.balance == 'Excellent' %}100%{% elif statistics.game_phases.follow_through.balance == 'Good' %}70%{% else %}40%{% endif %}" 
                                                        aria-valuenow="{% if statistics.game_phases.follow_through.balance == 'Excellent' %}100{% elif statistics.game_phases.follow_through.balance == 'Good' %}70{% else %}40{% endif %}" 
                                                        aria-valuemin="0" 
                                                        aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <div class="rating-score {% if statistics.game_phases.follow_through.balance == 'Excellent' %}rating-excellent{% elif statistics.game_phases.follow_through.balance == 'Good' %}rating-good{% else %}rating-needs-improvement{% endif %}">
                                                    {{ statistics.game_phases.follow_through.balance }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Detailed Stats Tab -->
        <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Complete Statistics</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Statistic</th>
                                            <th class="text-end">Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="2" class="table-primary">Serve</td>
                                        </tr>
                                        <tr>
                                            <td>Aces</td>
                                            <td class="text-end">{{ statistics.basic_stats.aces }}</td>
                                        </tr>
                                        <tr>
                                            <td>Double Faults</td>
                                            <td class="text-end">{{ statistics.basic_stats.double_faults }}</td>
                                        </tr>
                                        <tr>
                                            <td>First Serve Percentage</td>
                                            <td class="text-end">{{ statistics.basic_stats.first_serve_percentage }}%</td>
                                        </tr>
                                        <tr>
                                            <td>First Serve Points Won</td>
                                            <td class="text-end">{{ statistics.basic_stats.first_serve_points_won }}%</td>
                                        </tr>
                                        <tr>
                                            <td>Second Serve Points Won</td>
                                            <td class="text-end">{{ statistics.basic_stats.second_serve_points_won }}%</td>
                                        </tr>
                                        <tr>
                                            <td>Average Serve Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.serve.speed.avg }} mph</td>
                                        </tr>
                                        <tr>
                                            <td>Maximum Serve Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.serve.speed.max }} mph</td>
                                        </tr>
                                        <tr>
                                            <td>Minimum Serve Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.serve.speed.min }} mph</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="table-primary">Forehand</td>
                                        </tr>
                                        <tr>
                                            <td>Winners</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.winners }}</td>
                                        </tr>
                                        <tr>
                                            <td>Errors</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.errors }}</td>
                                        </tr>
                                        <tr>
                                            <td>Cross Court Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.placement.cross_court }}</td>
                                        </tr>
                                        <tr>
                                            <td>Down The Line Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.placement.down_the_line }}</td>
                                        </tr>
                                        <tr>
                                            <td>Inside Out Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.placement.inside_out }}</td>
                                        </tr>
                                        <tr>
                                            <td>Average Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.speed.avg }} mph</td>
                                        </tr>
                                        <tr>
                                            <td>Maximum Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.forehand.speed.max }} mph</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="table-primary">Backhand</td>
                                        </tr>
                                        <tr>
                                            <td>Winners</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.winners }}</td>
                                        </tr>
                                        <tr>
                                            <td>Errors</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.errors }}</td>
                                        </tr>
                                        <tr>
                                            <td>Cross Court Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.placement.cross_court }}</td>
                                        </tr>
                                        <tr>
                                            <td>Down The Line Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.placement.down_the_line }}</td>
                                        </tr>
                                        <tr>
                                            <td>Inside Out Shots</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.placement.inside_out }}</td>
                                        </tr>
                                        <tr>
                                            <td>Average Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.speed.avg }} mph</td>
                                        </tr>
                                        <tr>
                                            <td>Maximum Speed</td>
                                            <td class="text-end">{{ statistics.shot_analysis.backhand.speed.max }} mph</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="table-primary">Volley</td>
                                        </tr>
                                        <tr>
                                            <td>Winners</td>
                                            <td class="text-end">{{ statistics.shot_analysis.volley.winners }}</td>
                                        </tr>
                                        <tr>
                                            <td>Errors</td>
                                            <td class="text-end">{{ statistics.shot_analysis.volley.errors }}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="table-primary">Movement</td>
                                        </tr>
                                        <tr>
                                            <td>Distance Covered</td>
                                            <td class="text-end">{{ statistics.player_movement.distance_covered }} m</td>
                                        </tr>
                                        <tr>
                                            <td>Sprints</td>
                                            <td class="text-end">{{ statistics.player_movement.sprints }}</td>
                                        </tr>
                                        <tr>
                                            <td>Direction Changes</td>
                                            <td class="text-end">{{ statistics.player_movement.direction_changes }}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="table-primary">Other</td>
                                        </tr>
                                        <tr>
                                            <td>Break Points Saved</td>
                                            <td class="text-end">{{ statistics.basic_stats.break_points_saved }}</td>
                                        </tr>
                                        <tr>
                                            <td>Break Points Converted</td>
                                            <td class="text-end">{{ statistics.basic_stats.break_points_converted }}</td>
                                        </tr>
                                        <tr>
                                            <td>Total Points Won</td>
                                            <td class="text-end">{{ statistics.basic_stats.total_points_won }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Recommendation -->
    <div class="card mt-4 mb-5">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-robot me-2"></i>AI Improvement Recommendation</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h5>Focus Areas for Improvement</h5>
                    
                    {% if statistics.game_phases.preparation.shoulder_rotation == 'Needs Improvement' %}
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Shoulder Rotation</h6>
                        <p>Your shoulder rotation during preparation needs improvement. This affects your power generation and shot consistency.</p>
                        <h6 class="mt-3">Recommended Practice:</h6>
                        <ul>
                            <li>Shadow swings with focus on complete shoulder turn</li>
                            <li>Wall practice with exaggerated shoulder rotation</li>
                            <li>Partner feeding drill with focus solely on preparation phase</li>
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if statistics.shot_analysis.backhand.errors > statistics.shot_analysis.backhand.winners %}
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Backhand Consistency</h6>
                        <p>Your backhand is producing more errors than winners. Focus on improving consistency before adding power.</p>
                        <h6 class="mt-3">Recommended Practice:</h6>
                        <ul>
                            <li>Cross-court backhand rally drill with emphasis on consistency</li>
                            <li>Backhand depth control exercise with targets</li>
                            <li>Slow-paced backhand exchange focusing on technique</li>
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if statistics.basic_stats.first_serve_percentage < 60 %}
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>First Serve Percentage</h6>
                        <p>Your first serve percentage is below optimal level. Improving this will give you more control of points.</p>
                        <h6 class="mt-3">Recommended Practice:</h6>
                        <ul>
                            <li>Serve placement drill with accuracy targets</li>
                            <li>Reduced-power serve practice focusing on consistency</li>
                            <li>Service motion review and technical adjustment</li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h5 class="card-title">Overall Assessment</h5>
                            <div class="d-flex align-items-center mb-3">
                                <div class="progress flex-grow-1 me-3" style="height: 10px;">
                                    {% set avg_score = (statistics.game_phases.preparation.score + statistics.game_phases.backswing.score + statistics.game_phases.contact.score + statistics.game_phases.follow_through.score) / 4 %}
                                    <div class="progress-bar {% if avg_score >= 80 %}bg-success{% elif avg_score >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                        role="progressbar" 
                                        style="width: {{ avg_score }}%" 
                                        aria-valuenow="{{ avg_score }}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="fs-4 {% if avg_score >= 80 %}text-success{% elif avg_score >= 60 %}text-warning{% else %}text-danger{% endif %}">
                                    {{ avg_score|round(1) }}
                                </div>
                            </div>
                            <p>
                                {% if avg_score >= 80 %}
                                Your technique is well-developed. Focus on refining specific areas for competitive advantage.
                                {% elif avg_score >= 60 %}
                                Your fundamentals are solid. Targeted practice will help you reach the next level.
                                {% else %}
                                You have room for improvement in fundamentals. Consider working with a coach on technique.
                                {% endif %}
                            </p>
                            <div class="mt-4">
                                <h6>Strengths:</h6>
                                <ul class="mb-3">
                                    {% if statistics.game_phases.preparation.grip_rating == 'Excellent' %}
                                    <li>Excellent grip position</li>
                                    {% endif %}
                                    {% if statistics.game_phases.follow_through.completion == 'Excellent' %}
                                    <li>Complete follow through</li>
                                    {% endif %}
                                    {% if statistics.shot_analysis.forehand.winners > statistics.shot_analysis.forehand.errors %}
                                    <li>Effective forehand</li>
                                    {% endif %}
                                </ul>
                                <a href="#" class="btn btn-primary w-100">Download Full Report</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Analysis page specific scripts -->
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
{% endblock %}
